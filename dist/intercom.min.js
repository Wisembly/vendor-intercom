!function(t){window.WisemblyIntercom={version:"0.1.4",options:{identifier:"",script:"https://widget.intercom.io/widget/",scriptTimeout:5e3,trackTimeout:5e3,trackDelay:1e3,isEnabled:!0,bootData:{},onBoot:null,onStore:null,onFlush:null,onTrack:null,onTrackError:null,onScript:null,onScriptError:null},setOptions:function(e){e=e||{},this.options=t.extend(this.options,e)},init:function(){var t=this;this.boot()||this._loadScript().done(function(){t.boot()})},_get:function(t){return"function"==typeof this.options[t]?this.options[t].call(this):this.options[t]},_notify:function(t){"function"==typeof this.options[t]&&this.options[t].apply(this,[].slice.call(arguments,1))},_loadScript:function(){var e=this;return t.ajax({url:this._get("script")+this._get("identifier"),dataType:"script",timeout:this._get("scriptTimeout")}).done(function(){e._notify("onScript")}).fail(function(){e._notify("onScriptError")})},boot:function(){return this.isLoaded()&&this.isEnabled()?(this.initialized=!0,this.track("boot",t.extend({app_id:this._get("identifier")},this._get("bootData")),!0),this._notify("onBoot"),!0):!1},isLoaded:function(){return"function"==typeof window.Intercom},isReady:function(){return this.initialized},isEnabled:function(){return this._get("isEnabled")},track:function(t,e,i,n){return t?(this.store(t,e,i,n),this.isReady()&&this.isEnabled()&&this.flush(),!0):!1},store:function(e,i,n,s){this._storedEvents=this._storedEvents||[],this._storedId=this._storedId||0;var o={id:++this._storedId,dfd:t.Deferred(),type:e,data:i,metadata:n};return s!==!0?this._storedEvents.push(o):this._storedEvents.unshift(o),this._notify("onStore",o),o},flush:function(){var e=this,i=t.Deferred();if(this._dfd_flush)return this._dfd_flush;if(!this._storedEvents||!this._storedEvents.length)return i.resolve().promise();this._dfd_flush=i;var n=this._storedEvents.shift();switch(this._notify("onFlush",n),n.type){case"trackEvent":this.intercomTrackEvent(n);break;case"shutdown":this.intercomShutdown(n);break;case"boot":case"update":this.intercomUpdate(n)}return setTimeout(function(){"pending"===n.dfd.state()&&n.dfd.reject()},this._get("trackTimeout")),n.dfd.done(function(){e._notify("onTrack",n)}).fail(function(){e._notify("onTrackError",n)}).always(function(){e._dfd_flush=null,setTimeout(function(){e.flush().done(i.resolve)},e._get("trackDelay"))}),i.promise()},intercomShutdown:function(t){return this.isReady()&&this.isEnabled()?(this._storedEvents=null,this._trackEventStack=null,this._pingStack=null,this._hasRegisteredIntercomEvents=!1,this._fn_user_events_success=null,this.initialized=!1,window.Intercom("shutdown"),t.dfd.resolve(),t.dfd.promise()):t.dfd.reject().promise()},intercomTrackEvent:function(t){if(!this.isReady()||!this.isEnabled())return t.dfd.reject().promise();var e=this,i=null;return window.intercom_obj&&window.intercom_obj.user_events&&"function"==typeof window.intercom_obj.user_events.success_function_for_track_user_events&&(i=window.intercom_obj.user_events.success_function_for_track_user_events,this._trackEventStack=this._trackEventStack||[],this._trackEventStack.push(t),this._fn_user_events_success||(this._fn_user_events_success=function(){i.apply(this,arguments);var t=e._trackEventStack.shift();t&&t.dfd&&t.dfd.resolve()},window.intercom_obj.user_events.success_function_for_track_user_events=this._fn_user_events_success)),window.Intercom(t.type,t.data,t.metadata),i||t.dfd.resolve(),t.dfd.promise()},intercomUpdate:function(t){if(!this.isReady()||!this.isEnabled())return t.dfd.reject().promise();var e=this;window.Intercom(t.type,t.data,t.metadata);var i=null;return window.intercom_obj&&window.intercom_obj.events&&"function"==typeof window.intercom_obj.events.register_handler?(i=window.intercom_obj.events.register_handler,this._pingStack=this._pingStack||[],this._pingStack.push(t),this._hasRegisteredIntercomEvents||(this._hasRegisteredIntercomEvents=!0,i("PROCESSED_PING",function(){var t=e._pingStack.shift();t&&t.dfd&&t.dfd.resolve()},0),i("API_DISABLED",function(){var t=e._pingStack.shift();t&&t.dfd&&t.dfd.reject()},0))):t.dfd.resolve(),t.dfd.promise()}}}(jQuery);