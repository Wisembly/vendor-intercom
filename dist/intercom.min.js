!function(t){window.WisemblyIntercom={version:"0.1.3",options:{identifier:"",script:"https://widget.intercom.io/widget/",scriptTimeout:5e3,trackTimeout:5e3,trackDelay:1e3,isEnabled:!0,bootData:{},onBoot:null,onStore:null,onFlush:null,onTrack:null,onTrackError:null,onScript:null,onScriptError:null},setOptions:function(e){e=e||{},this.options=t.extend(this.options,e)},init:function(){var t=this;this.boot()||this._loadScript().done(function(){t.boot()})},_get:function(t){return"function"==typeof this.options[t]?this.options[t].call(this):this.options[t]},_notify:function(t){"function"==typeof this.options[t]&&this.options[t].apply(this,[].slice.call(arguments,1))},_loadScript:function(){var e=this;return t.ajax({url:this._get("script")+this._get("identifier"),dataType:"script",timeout:this._get("scriptTimeout")}).done(function(){e._notify("onScript")}).fail(function(){e._notify("onScriptError")})},boot:function(){return this.isEnabled()?(this.track("boot",t.extend({app_id:this._get("identifier")},this._get("bootData")),!0),this._notify("onBoot"),!0):!1},isReady:function(){return"function"==typeof window.Intercom&&this.options},isEnabled:function(){return this.isReady()?this._get("isEnabled"):!1},track:function(t,e,n,i){return t?(this.store(t,e,n,i),this.isReady()&&this.flush(),!0):!1},store:function(e,n,i,s){this._storedEvents=this._storedEvents||[],this._storedId=this._storedId||0;var o={id:++this._storedId,dfd:t.Deferred(),type:e,data:n,metadata:i};return s!==!0?this._storedEvents.push(o):this._storedEvents.unshift(o),this._notify("onStore",o),o},flush:function(){var e=this,n=t.Deferred();if(this._dfd_flush)return this._dfd_flush;if(!this._storedEvents||!this._storedEvents.length)return n.resolve().promise();this._dfd_flush=n;var i=this._storedEvents.shift();switch(this._notify("onFlush",i),i.type){case"trackEvent":this.intercomTrackEvent(i);break;case"shutdown":this.intercomShutdown(i);break;case"boot":case"update":this.intercomUpdate(i)}return setTimeout(function(){"pending"===i.dfd.state()&&i.dfd.reject()},this._get("trackTimeout")),i.dfd.done(function(){e._notify("onTrack",i)}).fail(function(){e._notify("onTrackError",i)}).always(function(){e._dfd_flush=null,setTimeout(function(){e.flush().done(n.resolve)},e._get("trackDelay"))}),n.promise()},intercomShutdown:function(t){return this.isReady()?(this._storedEvents=null,this._trackEventStack=null,this._pingStack=null,this._hasRegisteredIntercomEvents=!1,this._fn_user_events_success=null,window.Intercom("shutdown"),t.dfd.resolve(),t.dfd.promise()):t.dfd.reject().promise()},intercomTrackEvent:function(t){if(!this.isEnabled())return t.dfd.reject().promise();var e=this,n=null;return window.intercom_obj&&window.intercom_obj.user_events&&"function"==typeof window.intercom_obj.user_events.success_function_for_track_user_events&&(n=window.intercom_obj.user_events.success_function_for_track_user_events,this._trackEventStack=this._trackEventStack||[],this._trackEventStack.push(t),this._fn_user_events_success||(this._fn_user_events_success=function(){n.apply(this,arguments);var t=e._trackEventStack.shift();t&&t.dfd&&t.dfd.resolve()},window.intercom_obj.user_events.success_function_for_track_user_events=this._fn_user_events_success)),window.Intercom(t.type,t.data,t.metadata),n||t.dfd.resolve(),t.dfd.promise()},intercomUpdate:function(t){if(!this.isEnabled())return t.dfd.reject().promise();var e=this;window.Intercom(t.type,t.data,t.metadata);var n=null;return window.intercom_obj&&window.intercom_obj.events&&"function"==typeof window.intercom_obj.events.register_handler?(n=window.intercom_obj.events.register_handler,this._pingStack=this._pingStack||[],this._pingStack.push(t),this._hasRegisteredIntercomEvents||(this._hasRegisteredIntercomEvents=!0,n("PROCESSED_PING",function(){var t=e._pingStack.shift();t&&t.dfd&&t.dfd.resolve()},0),n("API_DISABLED",function(){var t=e._pingStack.shift();t&&t.dfd&&t.dfd.reject()},0))):t.dfd.resolve(),t.dfd.promise()}}}(jQuery);