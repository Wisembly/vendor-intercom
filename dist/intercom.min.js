!function(t){window.WisemblyIntercom={version:"0.1.1",options:{identifier:null,script:"https://widget.intercom.io/widget/",scriptTimeout:5e3,trackTimeout:5e3,trackDelay:1e3,isEnabled:!0,bootData:{},onBoot:null,onStore:null,onFlush:null,onTrack:null,onTrackError:null,onScript:null,onScriptError:null},setOptions:function(n){n=n||{},this.options=t.extend(this.options,n)},init:function(){var t=this;this.boot()||this._loadScript().done(function(){t.boot()})},_get:function(t){return"function"==typeof this.options[t]?this.options[t].call(this):this.options[t]},_notify:function(t){"function"==typeof this.options[t]&&this.options[t].apply(this,[].slice.call(arguments,1))},_loadScript:function(){var n=this;return t.ajax({url:this.options.script+(this.options.identifier||""),dataType:"script",timeout:this.options.scriptTimeout}).done(function(){n._notify("onScript")}).fail(function(){n._notify("onScriptError")})},boot:function(){return this.isEnabled()?(this._notify("onBoot"),!0):!1},isReady:function(){return"function"==typeof window.Intercom&&this.options},isEnabled:function(){return this.isReady()?this._get("isEnabled"):!1},track:function(t,n,e,i){return t?(this.store(t,n,e,i),this.isReady()&&this.flush(),!0):!1},store:function(n,e,i,s){this._storedEvents=this._storedEvents||[],this._storedId=this._storedId||0;var o={id:++this._storedId,dfd:t.Deferred(),type:n,data:e,metadata:i};return s!==!0?this._storedEvents.push(o):this._storedEvents.unshift(o),this._notify("onStore",o),o},flush:function(){var n=this,e=t.Deferred();if(this._dfd_flush)return this._dfd_flush;if(!this._storedEvents||!this._storedEvents.length)return e.resolve().promise();this._dfd_flush=e;var i=this._storedEvents.shift();switch(this._notify("onFlush",i),i.type){case"trackEvent":this.intercomTrackEvent(i);break;case"shutdown":this.intercomShutdown(i);break;case"boot":case"update":this.intercomUpdate(i)}return setTimeout(function(){"pending"===i.dfd.state()&&i.dfd.reject()},this.options.trackTimeout),i.dfd.done(function(){n._notify("onTrack",i)}).fail(function(){n._notify("onTrackError",i)}).always(function(){n._dfd_flush=null,setTimeout(function(){n.flush().done(e.resolve)},n.options.trackDelay)}),e.promise()},intercomShutdown:function(t){return this.isEnabled()?(this._storedEvents=null,this._trackEventStack=null,this._pingStack=null,this._hasRegisteredIntercomEvents=!1,this._fn_user_events_success=null,window.Intercom("shutdown"),t.dfd.resolve(),t.dfd.promise()):t.dfd.reject().promise()},intercomTrackEvent:function(t){if(!this.isEnabled())return t.dfd.reject().promise();var n=this,e=null;return window.intercom_obj&&window.intercom_obj.user_events&&"function"==typeof window.intercom_obj.user_events.success_function_for_track_user_events&&(e=window.intercom_obj.user_events.success_function_for_track_user_events,this._trackEventStack=this._trackEventStack||[],this._trackEventStack.push(t),this._fn_user_events_success||(this._fn_user_events_success=function(){e.apply(this,arguments);var t=n._trackEventStack.shift();t&&t.dfd&&t.dfd.resolve()},window.intercom_obj.user_events.success_function_for_track_user_events=this._fn_user_events_success)),window.Intercom(t.type,t.data,t.metadata),e||t.dfd.resolve(),t.dfd.promise()},intercomUpdate:function(t){if(!this.isEnabled())return t.dfd.reject().promise();var n=this;window.Intercom(t.type,t.data,t.metadata);var e=null;return window.intercom_obj&&window.intercom_obj.events&&"function"==typeof window.intercom_obj.events.register_handler?(e=window.intercom_obj.events.register_handler,this._pingStack=this._pingStack||[],this._pingStack.push(t),this._hasRegisteredIntercomEvents||(this._hasRegisteredIntercomEvents=!0,e("PROCESSED_PING",function(){var t=n._pingStack.shift();t&&t.dfd&&t.dfd.resolve()},0),e("API_DISABLED",function(){var t=n._pingStack.shift();t&&t.dfd&&t.dfd.reject()},0))):t.dfd.resolve(),t.dfd.promise()}}}(jQuery);